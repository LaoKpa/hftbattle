# Пакет для локальной разработки

Мы подготовили для вас пакет для локальной разработки стратегий на C++ и Python.
Он включает в себя набор библиотек и файлов, достаточный для разработки и тестирования стратегий на вашем компьютере.

Пакет опубликован на [GitHub](https://github.com/hftbattle/hftbattle).
Его можно скачать следующей командой (должен быть установлен [Git](http://git-scm.com/download)):

```bash
git clone https://github.com/hftbattle/hftbattle.git
```

Подробнее об использовании пакета для локальной разработки:

- [Установка зависимостей](#requirements)
- [Биржевые данные](#data)
- [Добавление стратегии](#add_strategy)
- [Запуск стратегии](#run_strategy)

## Установка зависимостей <a id = "requirements"></a>

В данном разделе описаны зависимости, необходимые для следующих операционных систем:

- [Ubuntu](#ubuntu)
- [macOS](#macos)
- [Windows](#windows)

### Ubuntu <a id = "ubuntu"></a>

Для установки зависимостей на Ubuntu можно запустить скрипт *packages_ubuntu.sh*, находящийся в корне репозитория:

```bash
sudo ./packages_ubuntu.sh
```

Скрипт устанавливает компилятор g++, систему сборки [CMake](https://cmake.org/) и Python 3:

```bash
sudo apt-get update && sudo apt-get install g++ cmake python3 --yes
```

### macOS <a id = "macos"></a>

Для установки зависимостей на macOS можно запустить скрипт *packages_mac.sh*, находящийся в корне репозитория:

```bash
./packages_mac.sh
```

Скрипт устанавливает:

- Компилятор Apple LLVM (подробное описание процедуру установки [здесь](http://osxdaily.com/2014/02/12/install-command-line-tools-mac-os-x/)):

  ```bash
  xcode-select --install
  ```

- Менеджер пакетов [Homebrew](http://brew.sh/):

  ```bash
  /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  ```

- [CMake](https://cmake.org/) и Python 3:

  ```bash
  brew install cmake python3
  ```

### Windows <a id = "windows"></a>

Для запуска под Windows необходимо иметь:

- Компилятор [TDM64-GCC](http://tdm-gcc.tdragon.net) версии `5.1.0` и выше:

  Скачать можно [здесь](http://tdm-gcc.tdragon.net/download).

- [CMake](https://cmake.org/) версии `2.8.4` и выше:

  Например, можно поставить [CLion](https://www.jetbrains.com/clion/download/), *CMake* при этом будет в комплекте.

  Или же [скачать CMake](https://cmake.org/) с официального сайта.

- Python `2.7` и выше:

  Скачать можно [здесь](https://www.python.org/downloads/).

Убедитесь, что пути до *cmake.exe*, *python.exe*, *g++.exe* и *mingw32-make.exe*/*make.exe* добавлены в переменную окружения *PATH*.

## Биржевые данные <a id = "data"></a>

В репозитории пакета находится папка *data*, в которой содержатся данные за несколько часов работы биржи (строка в файле конфигурации "day": "2016.09.02") для торгового инструмента контеста.

Этого достаточно для того, чтобы:

- убедиться, что ваш код компилируется
- отладить вашу стратегию

Чтобы проверить саму идею стратегии, вы можете скачать данные за один полный торговый день "2016.09.01" по [ссылке](https://www.dropbox.com/s/ko2zgwt004yejts/data.zip?dl=1).

Это можно сделать вручную, разархивировав затем файл в корень директории, или же с помощью скрипта *download.py*, лежащего в корне репозитория:

```bash
./download.py
```

Скрипт скачает файл *data.zip* и разархивирует его в папку *data*.

Для тестирования стратегии на полном дне нужно изменить поле "day" в файле конфигурации на "2016.09.01".

## Запуск стратегии <a id = "run_strategy"></a>

Здесь мы опишем два способа локального запуска стратегии:

- [Запуск из командной строки](#command_line)
- [Запуск из CLion](#clion)

Далее мы будем предполагать, что папка вашей стратегии, а также сама стратегия называются **user_strategy**.
О том, как создавать новые стратегии, читайте [здесь](#add_strategy).

### Запуск из командной строки <a id = "command_line"></a>

Для запуска из командной строки необходимо:

- **скомпилировать все имеющиеся стратегии**:

  ```bash
  ./build.py
  ```

  В результате для ваших стратегий будут собраны библиотеки в папке *build*.
- **запустить симуляцию**:

  ```bash
  ./run.py user_strategy
  ```

### Запуск из CLion <a id = "clon"></a>

Для запуска из [CLion](https://www.jetbrains.com/clion/download/) необходимо:

- **задать исполняемый файл**:

  Для этого необходимо зайти в *Run > Edit configurations* и в качестве *Executable* выбрать исполняемый файл в корне директории, соответствующий вашей платформе:

  - *mac_launcher* для macOS
  - *windows_launcher* для Windows
  - *linux_launcher* для Linux

- **прописать название стратегии** в аргументах командной строки:

  Для этого в той же вкладке *Run > Edit configurations* в строчке *Program arguments* необходимо написать путь до файла конфигурации вашей стратегии, например:

  ```bash
  strategies/user_strategy/user_strategy.json
  ```
- **запустить сборку проекта и симуляцию**, нажав кнопку *Run*.

## Добавление стратегии <a id = "add_strategy"></a>

Со временем у вас может возникнуть необходимость разрабатывать одновременно несколько различных стратегий или идей.
При этом держать всё в рамках одного файла становится неудобно.
В этом разделе мы расскажем о том, как можно добавлять новые стратегии в пакете для локальной разработки:

- [На языке C++](#cpp)
- [На языке Python](#python)

### Создание новой C++ стратегии <a id = "cpp"></a>

Для создания новой стратегии на языке C++:

#### 1. Создайте папку стратегии

- В папке `strategies` создайте копию папки `sample_strategy`
- Выберите имя для вашей стратегии.

  Далее, мы будем обозначать его *strategy_name*.

- Назовите новую папку, а также json и cpp файлы в ней *strategy_name*, *strategy_name.json*, *strategy_name.cpp* соответственно.

#### 2. Зарегистрируйте стратегию

После копирования файлов стратегии необходимо немного изменить *cpp* файл стратегии.
А именно, нужно **зарегистрировать** свою новую стратегию следующей командой в конце cpp-файла:

```c++
REGISTER_CONTEST_STRATEGY(UserStrategy, strategy_name)
```

Например, если ваша папка, .json-файл и стратегия называются *best_strategy_ever*, то вам необходимо добавить следующую строку в конец файла *best_strategy_ever.cpp*:

```c++
REGISTER_CONTEST_STRATEGY(UserStrategy, best_strategy_ever)
```

Необходимость регистрировать новую стратегию вызвана особенностями динамической линковки стратегий с симулятором.

#### 3. Перезагрузите CMake

- Для тех, кто работает из консоли, нужно заново выполнить скрипт *build.py*:
  ```bash
  ./build.py
  ```
- Если вы работаете из CLion, то вам нужно выполнить *Tools > CMake > Reload CMake Project*.

### Создание новой Python стратегии <a id = "python"></a>

К сожалению, пока нет возможности создавать новые папки для `Python` стратегий.
Пожалуйста, пишите свою стратегию в файле `strategies/python_strategy/python_strategy.py`.
О запуске стратегии вы можете почитать [здесь](#run_strategy).
